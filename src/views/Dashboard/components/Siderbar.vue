<script setup lang="ts">
import { t } from '@/locales';
import { ref } from 'vue'
import {
  DownloadOutlined,
  InfoCircleOutlined,
  MacCommandOutlined,
  PayCircleOutlined,
  PlayCircleOutlined,
  QuestionCircleOutlined,
  SettingOutlined,
  ToolOutlined,
} from '@ant-design/icons-vue';
import { message } from 'ant-design-vue';
import GlobalSettingsModal from '@/components/GlobalSettingsModal/index.vue'

const modalRef = ref<InstanceType<typeof GlobalSettingsModal>>()

// æµ‹è¯•ç”¨æˆ·æ•°æ®
const user = {
  name: "DreamyLucia742",
  balance: {
    points: 150,
    quickAnswers: 3,
    writtenQuestions: 8,
  },
  invitation: {
    count: 3,
    code: "test",
  },
};

// æ‹¼æ¥é‚€è¯·é“¾æ¥
const inviteLink = `offerai.cloud/?code=${user.invitation.code}`;

// å¥½å‹äº’åŠ©è®¡åˆ’æ•°æ®
const friendPlans = [
  { text: 'é‚€è¯·å¥½å‹ï¼Œä¸€äººå……å€¼ï¼Œä¸¤äººå—ç›Š', action: 'æŸ¥çœ‹è§„åˆ™' },
  { text: 'åŠ ç¾¤é¢† 10 å…ƒé¢åº¦ï¼ˆæ¯äººé™é¢†ä¸€æ¬¡ï¼‰', action: 'ç‚¹æˆ‘åŠ ç¾¤' },
  { text: 'æˆä¸ºæ ¡å›­ä»£ç†ï¼Œé‚€è¯·è¿”ä½£', action: 'ç‚¹æˆ‘æŠ¥å' },
];

// æ•™ç¨‹ä¸­å¿ƒæ•°æ®
const tutorials = [
  'é¢è¯•ç¬”è¯•å…¨åœºæ™¯æ•™ç¨‹ï¼ˆ15minï¼‰',
  'ç¬”è¯•æ¨¡å¼ä½¿ç”¨æ•™ç¨‹ï¼ˆ2minï¼‰',
  'åŒç«¯äº’è”æ•™ç¨‹ï¼ˆ10minï¼‰',
];

// æœ€æ–°åŠ¨æ€æ•°æ®
const changelog = [
  { text: 'å®¢æˆ·ç«¯ 2.0 å·²ä¸Šçº¿ï¼', date: '2025.5.1' },
  { text: 'æ•™ç¨‹ä¸­å¿ƒå·²ä¸Šçº¿~', date: '2025.4.1' },
  { text: 'ğŸ’¬ èŠå¤©æ¨¡å¼å·²æ¨å‡ºğŸ’¬', date: '2025.3.1' },
];

// ç¬¬ä¸€æ’æŒ‰é’®æ•°æ®
const firstRowButtons = [
  {
    icon: MacCommandOutlined,
    title: 'å¿«æ·æŒ‰é”®',
    action: () => message.success('ç‚¹å‡»äº†å¿«æ·æŒ‰é”®'),
  },
  {
    icon: QuestionCircleOutlined,
    title: 'ä½¿ç”¨æ‰‹å†Œ',
    action: () => message.success('ç‚¹å‡»äº†ä½¿ç”¨æ‰‹å†Œ'),
  },
  {
    icon: SettingOutlined,
    title: 'å…¨å±€è®¾ç½®',
    action: () => {
      modalRef.value?.open()
    },
  },
];

// ç¬¬äºŒæ’æŒ‰é’®æ•°æ®
const secondRowButtons = [
  {
    icon: DownloadOutlined,
    title: 'ä¸‹è½½å®¢æˆ·ç«¯',
    action: () => message.success('å¼€å§‹ä¸‹è½½å®¢æˆ·ç«¯'),
  },
  {
    icon: ToolOutlined,
    title: 'æŠ€æœ¯æ”¯æŒ',
    action: () => message.success('ç‚¹å‡»äº†æŠ€æœ¯æ”¯æŒ'),
  },
];

const copy = () => {
  navigator.clipboard.writeText(inviteLink);
  message.success("å¤åˆ¶æˆåŠŸ");
};

const recharge = () => {
  // TODO: å……å€¼é€»è¾‘
};
</script>

<template>
  <GlobalSettingsModal ref="modalRef" />
  <div class="flex flex-col h-full">
    <!-- å¤´éƒ¨ -->
    <div class="flex items-center gap-3 cursor-pointer justify-center">
      <div class="h-12 w-12">
        <img src="@/assets/logo.png" alt="Logo" class="h-full w-full object-contain">
      </div>
      <span class="text-3xl font-bold ml-2 primary">{{ t('productName') }}</span>
    </div>

    <!-- ä¸»è¦éƒ¨åˆ† -->
    <div class="flex flex-col items-center h-full mt-4 rounded-[30px] body-bg px-4 py-4">
      <!-- å¤´åƒ -->
      <div class="flex w-full items-center">
        <div class="flex gap-3">
          <div class="h-8 w-8">
            <img src="@/assets/img/SelectPage/userImg.jpg" alt="UserImg" class="h-full w-full object-contain">
          </div>
          <span class="text-xl font-bold ml-2 text-primary text-ellipsis-single-line">{{ user.name }}</span>
        </div>
        <button
          class="flex items-center ml-auto normal-button px-4 py-2 font-bold"
          @click="recharge"
        >
          å……å€¼
          <PayCircleOutlined class="primary ml-2 text-xl" />
        </button>
      </div>

      <!-- æ˜ç»† -->
      <div class="flex w-full items-center space-x-4 mt-4">
        <div class="flex flex-col box-bg space-y-2 py-2 px-4 rounded-[10px] w-[200px] cursor-pointer box-stress">
          <div class="flex items-center justify-between">
            <span class="text-primary font-bold text-xl">ä½™é¢</span>
            <span class="text-secondary text-sm">æ˜ç»†></span>
          </div>
          <div class="flex items-end">
            <span class="text-primary font-bold text-xl">{{ user.balance.points }}</span>
            <span class="text-secondary ml-2 text-sm">ACE ç‚¹</span>
          </div>
          <span class="text-secondary text-sm">{{ user.balance.quickAnswers }} æ¬¡å¿«ç­” / {{ user.balance.writtenQuestions }} é“ç¬”è¯•é¢˜</span>
        </div>
        <div class="flex flex-col box-bg space-y-2 py-2 px-4 rounded-[10px] w-[200px] cursor-pointer box-stress">
          <div class="flex items-center justify-between">
            <span class="text-primary font-bold text-xl">é‚€è¯·è®°å½•</span>
            <span class="text-secondary text-sm">æ˜ç»†></span>
          </div>
          <div class="flex items-end">
            <span class="text-primary font-bold text-xl">{{ user.invitation.count }}</span>
            <span class="text-secondary ml-2 text-sm">äºº</span>
          </div>
          <span class="text-secondary text-sm">åŠ å…¥å¥½å‹äº’åŠ©è®¡åˆ’</span>
        </div>
      </div>
      <!-- å¥½å‹äº’åŠ©è®¡åˆ’ -->
      <div class="flex flex-col w-full box-bg space-y-2 py-2 px-4 rounded-[10px] mt-4">
        <div class="flex items-center justify-between">
          <span class="text-primary font-bold text-xl">å¥½å‹äº’åŠ©è®¡åˆ’</span>
          <span class="text-secondary text-sm">å¡«å†™é‚€è¯·ç ></span>
        </div>
        <div class="flex flex-col text-sm">
          <div v-for="(item, index) in friendPlans" :key="index" class="flex justify-between">
            <span class="text-secondary">{{ item.text }}</span>
            <span class="primary hover:underline cursor-pointer">{{ item.action }}</span>
          </div>
        </div>
        <div class="flex justify-between">
          <span class="text-primary invite-code-container px-4 text-sm rounded-[10px] allow-select">{{ inviteLink }}</span>
          <button
            class="flex items-center ml-auto normal-button px-4 text-sm font-bold"
            @click="copy"
          >
            å¤åˆ¶
          </button>
        </div>
      </div>
      <!-- æ•™ç¨‹ä¸­å¿ƒ -->
      <div class="flex flex-col w-full box-bg space-y-2 py-2 px-4 rounded-[10px] mt-4">
        <div class="flex items-center justify-between">
          <span class="text-primary font-bold text-xl">æ•™ç¨‹ä¸­å¿ƒ</span>
        </div>
        <div class="flex flex-col text-sm text-secondary">
          <div v-for="(item, index) in tutorials" :key="index" class="flex space-x-2">
            <PlayCircleOutlined />
            <span class="hover:underline cursor-pointer">{{ item }}</span>
          </div>
        </div>
      </div>
      <!-- æœ€æ–°åŠ¨æ€ -->
      <div class="flex flex-col w-full box-bg space-y-2 py-2 px-4 rounded-[10px] mt-4">
        <div class="flex items-center justify-between">
          <span class="text-primary font-bold text-xl">æœ€æ–°åŠ¨æ€</span>
        </div>
        <div class="flex flex-col text-sm text-secondary">
          <div v-for="(item, index) in changelog" :key="index" class="flex justify-between">
            <div class="flex space-x-2">
              <InfoCircleOutlined />
              <span class="hover:underline cursor-pointer">{{ item.text }}</span>
            </div>
            <span>{{ item.date }}</span>
          </div>
        </div>
      </div>
      <!-- æŒ‰é”® -->
      <div class="flex flex-col w-full space-y-2 mt-auto">
        <!-- ç¬¬ä¸€æ’æŒ‰é’® -->
        <div class="flex space-x-4 w-full">
          <button
            v-for="(btn, index) in firstRowButtons"
            :key="`first-${index}`"
            class="flex-1 flex items-center justify-center py-2 normal-button space-x-2"
            @click="btn.action"
          >
            <component :is="btn.icon" />
            <span class="text-sm">{{ btn.title }}</span>
          </button>
        </div>

        <!-- ç¬¬äºŒæ’æŒ‰é’® -->
        <div class="flex space-x-4 w-full">
          <button
            v-for="(btn, index) in secondRowButtons"
            :key="`second-${index}`"
            class="flex-1 flex items-center justify-center py-2 normal-button space-x-2"
            @click="btn.action"
          >
            <component :is="btn.icon" />
            <span class="text-sm">{{ btn.title }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<style lang="scss">
@use '@/style/custom-theme' as *;
.box-stress {
  transition: all 0.2s ease;
  &:hover {
    background-color: var(--normal-layout-border-color);
  }
}

.invite-code-container {
  border: solid 2px var(--normal-layout-border-color);
}
</style>
